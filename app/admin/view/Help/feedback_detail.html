{extend name="base" /}
{block name="resources"}
    <link rel="stylesheet" href="/static/component/pear/css/pear.css" />
{/block}
{block name="body"}
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body" style="padding: 15px 10px!important;">
            <div class="layui-form layui-tab layui-tab-brief" lay-filter="component-tabs-brief">
                <ul class="layui-tab-title">
                    <li><a href="{:url('helpFeedback')}">全部记录</a></li>
                    <li><a href="{:url('helpFeedbackList', ['id' => 0])}">待处理</a></li>
                    <li><a href="{:url('helpFeedbackList', ['id' => 1])}">已处理</a></li>
                    <li class="layui-this"><a>反馈明细</a></li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show" style="margin-top: 10px; background-color: #f7f7f7; padding: 15px; border-radius: 4px;">
                        <form class="layui-form" action="" lay-filter="component-form-element">

                            <div class="layui-form-item">
                                <label class="layui-form-label">所属用户</label>
                                <div class="layui-input-block">
                                    <div class="layui-form-mid">{$info.member.username}</div>
                                </div>
                            </div>
                    
                            <div class="layui-form-item">
                                <label class="layui-form-label">提交时间</label>
                                <div class="layui-input-block">
                                    <div class="layui-form-mid">{$info.create_time}</div>
                                </div>
                            </div>
                    
                            <hr size="0" color="#fefefe" />
                    
                            <div class="layui-form-item">
                                <label class="layui-form-label">反馈明细</label>
                                <div class="layui-input-block">
                                    <div class="layui-form-mid">{$info.content|raw}</div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">回复信息</label>
                                <div class="layui-input-block" style="max-width: 800px;">
                                    <script id="container" name="reply" type="text/plain">{$e.reply|raw}</script>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="save">立即提交</button>
                                    <button type="reset" class="layui-btn layui-btn-sm layui-btn-primary">重置</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="scripts"}
<script src="__STATIC__/common/js/ueditor/ueditor.config.js"></script>
<script src="__STATIC__/common/js/ueditor/ueditor.all.js"></script>
<script>
    layui.use(['form','jquery','table'],function(){
        var $ = layui.$
        ,form = layui.form
        ,table = layui.table;

        var ue = UE.getEditor('container', {
            toolbars: [
                [
                    'fullscreen', 'source', 'undo', 'redo', '|', 'bold', 'italic', 
                    'underline', 'fontborder', 'strikethrough', 'removeformat', 
                    'formatmatch', 'simpleupload', '|', 'forecolor', 'backcolor',
                    'fontsize', 'link'
                ]
            ],
            initialFrameHeight: 210,
            zIndex : 0
        });

        form.on('submit(save)', function(data){
            $.ajax({
                data:JSON.stringify(data.field),
                dataType:'json',
                contentType:'application/json',
                type:'post',
                success:function(res){
                    if(res && res.code == 999){
                        parent.layer.msg(res.message, {
                            icon: 5,
                            time: 2000,
                        })
                        return false;
                    }else if(res.code == 0){
                        parent.layer.msg(res.message,{icon:1,time:1000},function(){
                            location.replace(document.referrer);
                        });
                    }else{
                        parent.layer.msg(res.message,{icon:2,time:1000});
                    }
                }
            })
            return false;
        });
    })
</script>
{/block}